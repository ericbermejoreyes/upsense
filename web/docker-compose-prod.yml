version: '3'

services:
    app:
        # Upsense web app
        container_name: upsense_app
        build: 
            context: ./
            dockerfile: docker/production/app.dockerfile
        image: upsense_app:latest
        volumes:
            - ./storage:/var/www/storage
        env_file: '.env.prod'
        environment: 
            - "DB_HOST=upsense"
        restart:
            on-failure
    
            
    # nginx web server
    web:
        container_name: upsense_nginx
        image: upsense_web:latest
        build:
            context: ./
            dockerfile: docker/production/web.dockerfile
        volumes:
            - ./storage/logs/:/var/log/nginx
            - ./:/var/www/html
        working_dir: /var/www/html
        extra_hosts:
            - "dockerhost:127.0.0.1"
        ports: 
            - 8990:80
            # - 4433:443
        restart:
            on-failure

volumes:
    dbdata:
        # driver: local

networks:
    default:
        external:
            name: upsense_default